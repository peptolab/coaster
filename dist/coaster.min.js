/*!
 * Coaster.js v1.0.3
 * (c) 2020-2020 Simon Mundy <simon.mundy@peptolab.com> (https://www.peptolab.com)
 * Released under the MIT License.
 */
!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Coaster=s()}(this,(function(){"use strict";class t{constructor(t){this.slide=t,this.active=!1,this.moving=!1,this.dragging=!1,this.transition=[],this.moveEndFn=this.moveEnd.bind(this)}isActive(){return this.active}isMoving(){return this.moving}isDragging(){return this.dragging}activate(){this.active=!0,this.slide.classList.add("active")}deactivate(){this.active=!1,this.slide.classList.remove("active")}dragStart(){this.dragging=!0,this.slide.classList.add("dragging")}dragStop(){this.dragging=!1,this.slide.classList.remove("dragging")}dragMove(t,s){this.slide.style.transform=`translateX(${t}px)`,!0===s&&(this.addTransition("transitioning"),this.addTransition("carousel__transition--drag"),this.slide.addEventListener("transitionend",this.moveEndFn,!0))}dragReset(){this.slide.style.transform=null}addTransition(t){this.transition.push(t),this.slide.classList.add(t)}removeTransition(t){this.transition.filter((s=>s!==t)),this.slide.classList.remove(t)}move(t,s,e){this.moving=!0;const i=`carousel__transition--${s}`,a=`carousel__transition--${s}-${e}`;"in"==t&&this.addTransition(a),requestAnimationFrame((()=>{this.addTransition("transitioning"),this.addTransition(i),"in"==t?this.removeTransition(a):this.addTransition(a),this.slide.offsetWidth,this.slide.addEventListener("transitionend",this.moveEndFn,!0)}))}drag(t,s,e){this.moving=!0;const i=`carousel__transition--${s}`,a=`carousel__transition--${s}-${e}`;this.slide.style.transform=null,this.addTransition("transitioning"),this.addTransition(i),"in"==t?this.removeTransition(a):this.addTransition(a),this.slide.addEventListener("transitionend",this.moveEndFn,!0)}moveEnd(){this.moving=!1,this.slide.removeEventListener("transitionend",this.moveEndFn,!0),this.transition.forEach((t=>this.removeTransition(t))),this.dragReset()}}return class extends class{constructor(t,s){this.DOM={carousel:t,track:null,navPrev:null,navNext:null,navPaginator:null},this.carousel={index:-1,slides:[],current:null,after:null,before:null,autoplay:null,delay:null,queue:null,dragevent:null,fn:{navigate:null,dragStart:null,dragEnd:null,dragMove:null,transitionEnd:null,autoplay:null}},this.options={threshold:200,drag:{touch:!0,mouse:!1},autoplay:{active:!1,interval:0},transition:{type:{click:"slide"}},selector:{track:"[data-carousel-track]",slide:"[data-carousel-slide]",caption:"[data-carousel-slide]",navPrev:'[data-carousel-nav="prev"]',navNext:'[data-carousel-nav="next"]',paginator:"[data-carousel-pagination] [data-carousel-nav]"},onStart:null,onStop:null,onPause:null,onChange:null},this.setOptions(s),this.setSlides(),this.setCarousel(),this.setNav(),this.addListeners(),this.options.autoplay.active&&this.play(),this.options.onStart&&this.options.onStart(this.carousel.current)}setOptions(t){this.options=Object.assign(this.options,t)}setCarousel(){this.carousel.fn.navigate=this.clickNavigate.bind(this),this.carousel.fn.dragStart=this.dragStart.bind(this),this.carousel.fn.dragEnd=this.dragEnd.bind(this),this.carousel.fn.dragMove=this.dragMove.bind(this),this.carousel.index=0,this.carousel.current=this.carousel.slides[this.carousel.index],this.carousel.current.activate(),this.options.onChange&&this.options.onChange(this.carousel,this.DOM)}setSlides(){if(this.DOM.track=this.DOM.carousel.querySelector(this.options.selector.track),[...this.DOM.carousel.querySelectorAll(this.options.selector.slide)].forEach((s=>this.carousel.slides.push(new t(s)))),!this.carousel.slides.length)return!1}setNav(){this.DOM.navPrev=this.DOM.carousel.querySelector(this.options.selector.navPrev),this.DOM.navNext=this.DOM.carousel.querySelector(this.options.selector.navNext),this.DOM.navPaginator=[...this.DOM.carousel.querySelectorAll(this.options.selector.paginator)]}setCaption(){this.DOM.caption=this.DOM.carousel.querySelector("[data-carousel-caption]")}addListeners(){this.options.drag.touch&&(this.DOM.track.addEventListener("touchstart",this.carousel.fn.dragStart),this.DOM.track.addEventListener("touchend",this.carousel.fn.dragEnd),this.DOM.track.addEventListener("touchmove",this.carousel.fn.dragMove)),this.options.drag.mouse&&this.DOM.track.addEventListener("mousedown",this.carousel.fn.dragStart),this.DOM.navPrev.addEventListener("click",this.carousel.fn.navigate),this.DOM.navNext.addEventListener("click",this.carousel.fn.navigate),this.DOM.navPaginator.forEach((t=>t.addEventListener("click",this.carousel.fn.navigate)))}play(){this.options.autoplay.active=!0,this.carousel.fn.autoplay=this.autoplay.bind(this),this.carousel.autoplay=setTimeout(this.carousel.fn.autoplay,this.options.autoplay.interval)}pause(){this.options.autoplay.active=!1,clearTimeout(this.carousel.autoplay)}autoplay(){this.navigate("next",this.options.transition.type.click),this.options.autoplay.active&&this.play()}navigate(t,s){let e,i;if(this.carousel.current.isMoving()){return(a=function(){this.navigate(t,s)}.bind(this),r=50,function(){var t=this,s=arguments,e=function(){o=null,n||a.apply(t,s)},i=n&&!o;clearTimeout(o),o=setTimeout(e,r),i&&a.apply(t,s)})()}var a,r,n,o;switch(t){case"prev":(t=this.carousel.index-1)<0&&(t=this.carousel.slides.length-1),e="prev",i="next";break;case"next":(t=this.carousel.index+1)>=this.carousel.slides.length&&(t=0),e="next",i="prev";break;default:e=(t-=1)<this.carousel.index?"prev":"next",i=t<this.carousel.index?"next":"prev"}if(t==this.carousel.index)return!1;switch(this.carousel.before=this.carousel.slides[this.carousel.index],this.carousel.current=this.carousel.slides[t],this.carousel.index=t,s){case"fade":case"slide":this.carousel.before.move("out",s,e),this.carousel.current.move("in",s,i);break;case"drag":this.carousel.before.drag("out",s,e),this.carousel.current.drag("in",s,i)}this.carousel.before.deactivate(),this.carousel.current.activate(),this.options.onChange&&this.options.onChange(this.carousel,this.DOM)}clickNavigate(t){this.navigate(t.currentTarget.dataset.carouselNav,this.options.transition.type.click),this.pause()}dragStart(t){if(this.carousel.dragevent=t||window.event,this.carousel.dragevent.preventDefault(),this.pause(),this.carousel.current.isMoving())return!1;this.carousel.currentInitialX=this.carousel.current.slide.offsetLeft,"touchstart"==this.carousel.dragevent.type?this.carousel.dragInitialX=this.carousel.newX=this.carousel.dragevent.touches[0].clientX:(this.carousel.dragInitialX=this.carousel.newX=this.carousel.dragevent.clientX,document.addEventListener("mouseup",this.carousel.fn.dragEnd),document.addEventListener("mousemove",this.carousel.fn.dragMove)),this.carousel.before=this.carousel.index>0?this.carousel.slides[this.carousel.index-1]:this.carousel.slides[this.carousel.slides.length-1],this.carousel.after=this.carousel.index<this.carousel.slides.length-1?this.carousel.slides[this.carousel.index+1]:this.carousel.slides[0],[this.carousel.current,this.carousel.before,this.carousel.after].forEach((t=>{t.dragStart()})),this.dragPosition(0)}dragMove(t){(t=t||window.event).preventDefault(),t.stopPropagation(),this.carousel.newX="touchmove"==t.type?t.touches[0].clientX:t.clientX,this.carousel.calculatedX=this.carousel.currentInitialX-(this.carousel.dragInitialX-this.carousel.newX),this.dragPosition(this.carousel.calculatedX,!1)}dragPosition(t,s){let e=this.carousel.currentInitialX-(this.carousel.dragInitialX-this.carousel.newX);this.carousel.current.dragMove(t,s),e>0?(this.carousel.before.dragMove(t-this.carousel.current.slide.offsetWidth,s),this.carousel.before!=this.carousel.after&&this.carousel.after.dragMove(t+this.carousel.current.slide.offsetWidth,s)):(this.carousel.after.dragMove(t+this.carousel.current.slide.offsetWidth,s),this.carousel.before!=this.carousel.after&&this.carousel.before.dragMove(t-this.carousel.current.slide.offsetWidth,s))}dragEnd(t){[this.carousel.current,this.carousel.before,this.carousel.after].forEach((t=>{t.dragStop()}));let s=this.carousel.currentInitialX-(this.carousel.dragInitialX-this.carousel.newX);s<-this.options.threshold?(this.carousel.before.dragReset(),this.navigate("next","drag")):s>this.options.threshold?(this.carousel.after.dragReset(),this.navigate("prev","drag")):this.dragPosition(0,!0),document.removeEventListener("mouseup",this.carousel.fn.dragEnd),document.removeEventListener("mousemove",this.carousel.fn.dragMove)}}{}}));
